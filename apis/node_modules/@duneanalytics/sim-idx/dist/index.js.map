{"version":3,"sources":["../src/index.ts","../src/db.ts","../src/types.ts","../src/app.ts","../src/middlewares.ts"],"sourcesContent":["import * as db from './db';\nimport * as App from './app';\nimport * as types from './types';\nimport * as middlewares from './middlewares';\n\nexport { App, db, types, middlewares };\n","// TODO: Extract to library\nimport { customType } from 'drizzle-orm/pg-core';\nimport { drizzle as drizzleNeon } from 'drizzle-orm/neon-http';\nimport { drizzle as drizzlePostgres } from 'drizzle-orm/node-postgres';\nimport { Address, Uint, Int, Bytes } from './types';\nimport { Context } from 'hono';\n\nexport const client = <\n\tT extends {\n\t\tBindings: Partial<{\n\t\t\tHYPERDRIVE?: {\n\t\t\t\tconnectionString: string;\n\t\t\t};\n\t\t\tDB_CONNECTION_STRING?: string;\n\t\t}> &\n\t\t\tRecord<string, any>;\n\t},\n>(\n\tc: Context<T>,\n) => {\n\tlet dbClient: ReturnType<typeof drizzleNeon | typeof drizzlePostgres>;\n\n\tif (!c.env.DB_CONNECTION_STRING) {\n\t\tthrow new Error('Missing required environment variable: DB_CONNECTION_STRING');\n\t}\n\n\tif (c.env.HYPERDRIVE?.connectionString) {\n\t\tdbClient = drizzlePostgres(c.env.HYPERDRIVE.connectionString);\n\t} else {\n\t\tdbClient = drizzleNeon(c.env.DB_CONNECTION_STRING);\n\t}\n\n\treturn dbClient;\n};\n\nexport const address = customType<{ data: Address; notNull: false; default: false }>({\n\tdataType() {\n\t\treturn 'bytea';\n\t},\n\ttoDriver(value) {\n\t\treturn value.address;\n\t},\n\tfromDriver(value: unknown) {\n\t\tif (!(value instanceof Buffer)) {\n\t\t\tthrow new Error('Expected Buffer for bytea type');\n\t\t}\n\t\treturn new Address(value);\n\t},\n});\n\nconst internalBytes = (width?: number) =>\n\tcustomType<{ data: Bytes; notNull: false; default: false }>({\n\t\tdataType() {\n\t\t\treturn 'bytea';\n\t\t},\n\t\ttoDriver(value) {\n\t\t\treturn value.data.subarray(0, width);\n\t\t},\n\t\tfromDriver(value: unknown) {\n\t\t\tif (!(value instanceof Buffer)) {\n\t\t\t\tthrow new Error('Expected Buffer for bytea type');\n\t\t\t}\n\t\t\treturn new Bytes(value.subarray(0, width));\n\t\t},\n\t});\n\nexport const bytes = internalBytes();\nexport const bytes1 = internalBytes(1);\nexport const bytes2 = internalBytes(2);\nexport const bytes3 = internalBytes(3);\nexport const bytes4 = internalBytes(4);\nexport const bytes5 = internalBytes(5);\nexport const bytes6 = internalBytes(6);\nexport const bytes7 = internalBytes(7);\nexport const bytes8 = internalBytes(8);\nexport const bytes9 = internalBytes(9);\nexport const bytes10 = internalBytes(10);\nexport const bytes11 = internalBytes(11);\nexport const bytes12 = internalBytes(12);\nexport const bytes13 = internalBytes(13);\nexport const bytes14 = internalBytes(14);\nexport const bytes15 = internalBytes(15);\nexport const bytes16 = internalBytes(16);\nexport const bytes17 = internalBytes(17);\nexport const bytes18 = internalBytes(18);\nexport const bytes19 = internalBytes(19);\nexport const bytes20 = internalBytes(20);\nexport const bytes21 = internalBytes(21);\nexport const bytes22 = internalBytes(22);\nexport const bytes23 = internalBytes(23);\nexport const bytes24 = internalBytes(24);\nexport const bytes25 = internalBytes(25);\nexport const bytes26 = internalBytes(26);\nexport const bytes27 = internalBytes(27);\nexport const bytes28 = internalBytes(28);\nexport const bytes29 = internalBytes(29);\nexport const bytes30 = internalBytes(30);\nexport const bytes31 = internalBytes(31);\nexport const bytes32 = internalBytes(32);\n\nconst uint = (width: number) =>\n\tcustomType<{ data: Uint; notNull: false; default: false }>({\n\t\tdataType() {\n\t\t\treturn 'numeric';\n\t\t},\n\t\ttoDriver(value) {\n\t\t\treturn value.value;\n\t\t},\n\t\tfromDriver(value: unknown) {\n\t\t\tif (typeof value === 'string') {\n\t\t\t\t// Base 10\n\t\t\t\treturn new Uint(BigInt(value));\n\t\t\t}\n\t\t\tthrow new Error('Invalid type for Uint: ' + typeof value);\n\t\t},\n\t});\n\nexport const uint8 = uint(8);\nexport const uint16 = uint(16);\nexport const uint24 = uint(24);\nexport const uint32 = uint(32);\nexport const uint40 = uint(40);\nexport const uint48 = uint(48);\nexport const uint56 = uint(56);\nexport const uint64 = uint(64);\nexport const uint72 = uint(72);\nexport const uint80 = uint(80);\nexport const uint88 = uint(88);\nexport const uint96 = uint(96);\nexport const uint104 = uint(104);\nexport const uint112 = uint(112);\nexport const uint120 = uint(120);\nexport const uint128 = uint(128);\nexport const uint136 = uint(136);\nexport const uint144 = uint(144);\nexport const uint152 = uint(152);\nexport const uint160 = uint(160);\nexport const uint256 = uint(256);\n\nconst int = (width: number) =>\n\tcustomType<{ data: Int; notNull: false; default: false }>({\n\t\tdataType() {\n\t\t\treturn 'numeric';\n\t\t},\n\t\ttoDriver(value) {\n\t\t\treturn value.value;\n\t\t},\n\t\tfromDriver(value: unknown) {\n\t\t\tif (typeof value === 'string') {\n\t\t\t\t// Base 10\n\t\t\t\treturn new Int(BigInt(value));\n\t\t\t}\n\t\t\tthrow new Error('Invalid type for Int: ' + typeof value);\n\t\t},\n\t});\n\nexport const int8 = int(8);\nexport const int16 = int(16);\nexport const int24 = int(24);\nexport const int32 = int(32);\nexport const int40 = int(40);\nexport const int48 = int(48);\nexport const int56 = int(56);\nexport const int64 = int(64);\nexport const int72 = int(72);\nexport const int80 = int(80);\nexport const int88 = int(88);\nexport const int96 = int(96);\nexport const int104 = int(104);\nexport const int112 = int(112);\nexport const int120 = int(120);\nexport const int128 = int(128);\nexport const int136 = int(136);\nexport const int144 = int(144);\nexport const int152 = int(152);\nexport const int160 = int(160);\nexport const int256 = int(256);\n\nexport const struct = <TData>(name: string) =>\n\tcustomType<{ data: TData; driverData: string }>({\n\t\tdataType() {\n\t\t\treturn 'jsonb';\n\t\t},\n\t\ttoDriver(value: TData): string {\n\t\t\treturn JSON.stringify(value);\n\t\t},\n\t})(name);\n","// TODO: Extract to library\n\nexport class Address {\n\taddress: Buffer;\n\n\tconstructor(address: Buffer) {\n\t\tthis.address = address;\n\t}\n\n\ttoJSON() {\n\t\t// TODO: Serialize with checksum\n\t\treturn '0x' + this.address.toString('hex');\n\t}\n\n\tstatic from(s: string): Address {\n\t\tif (s.startsWith('0x')) {\n\t\t\treturn new Address(Buffer.from(s.slice(2), 'hex'));\n\t\t}\n\t\treturn new Address(Buffer.from(s, 'hex'));\n\t}\n}\n\nexport class Bytes {\n\tdata: Buffer;\n\n\tconstructor(data: Buffer) {\n\t\tthis.data = data;\n\t}\n\n\ttoJSON() {\n\t\treturn '0x' + this.data.toString('hex');\n\t}\n\n\tstatic from(s: string): Bytes {\n\t\tif (s.startsWith('0x')) {\n\t\t\treturn new Bytes(Buffer.from(s.slice(2), 'hex'));\n\t\t}\n\t\treturn new Bytes(Buffer.from(s, 'hex'));\n\t}\n}\n\nexport class Uint {\n\tvalue: bigint;\n\n\tconstructor(value: bigint) {\n\t\tthis.value = value;\n\t}\n\n\ttoJSON() {\n\t\treturn this.value.toString(10);\n\t}\n}\n\nexport class Int {\n\tvalue: bigint;\n\n\tconstructor(value: bigint) {\n\t\tthis.value = value;\n\t}\n\n\ttoJSON() {\n\t\treturn this.value.toString(10);\n\t}\n}\n","import { Hono } from 'hono';\nimport { HonoOptions } from 'hono/hono-base';\n\n/**\n * Creates a new Hono application instance with the specified environment variables.\n */\nexport const create = <EnvVariables extends {}>(options?: HonoOptions<{ Bindings: EnvVariables }>) => {\n\treturn new Hono<{ Bindings: EnvVariables }>(options);\n};\n","import { Context } from 'hono';\n\nconst authHeaderName = 'X-IDX-AUTHENTICATED-API-KEY-NAME';\n\nexport const authentication = async (c: Context, next: () => Promise<void>): Promise<Response | void> => {\n\tconst isProduction = c.env?.NODE_ENV === 'production';\n\tif (!isProduction) {\n\t\treturn await next();\n\t}\n\n\tconst authHeader = c.req.header(authHeaderName);\n\tif (!authHeader) {\n\t\treturn Response.json({ unauthenticated: true }, { status: 401 });\n\t}\n\n\treturn await next();\n};\n"],"mappings":"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","names":["address","drizzlePostgres","drizzleNeon"]}